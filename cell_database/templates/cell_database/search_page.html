{% extends "base_generic.html" %}

{% load static %}
{% block content %}


<style>
table {
    border-collapse:collapse;

}
table, th, td {
    border:1px solid black;}


</style>


<h1>Search Stuff</h1>



<form action="{% url 'cell_database:search_page' %}" method="post">
    {% csrf_token %}
    <table>
        <tr>
            <h2>Wet Cells</h2>
            {%if wet_cell_page_form %}
                Display Page: {{wet_cell_page_form.page_number}}
            {%endif%}
            {%if search_cell_by_valid_metadata_form %}
                Show Visuals: {{search_cell_by_valid_metadata_form.show_visuals}}

            {%endif%}
            <input type="submit" name = 'preview_wet_cell' value="Preview Wet Cell">
            <input type="submit" name = 'search_validated_cycling_data' value="Preview Validated Cycling Data">


            {%if wet_cells_preview_form %}
                <br>
                Showing page {{wet_cell_page_number}}/{{wet_cell_max_page_number}}.
                {{ wet_cells_preview_form }}
                {% if dataset_form %}
                    Target Dataset: {{ dataset_form.dataset }}
                {% endif %}
                <input type="submit" name = 'register_wet_cells_to_dataset' value="Register to Dataset">

            {% endif %}
            {% if cell_id_overview_formset %}
                {% csrf_token %}
                {{ cell_id_overview_formset.management_form }}
                <br>
                Showing page {{wet_cell_page_number}}/{{wet_cell_max_page_number}}.
                    <table>
                    <col width = "200">
                    <col width = "5">

                            <tr>
                                <th>Cell ID</th>
                                <th>Exclude</th>
                                <th>Number of Active Files</th>
                                <th>Number of Imported But Deprecated Files</th>
                                <th>Number which Needs Importing</th>
                                <th>First Active File</th>
                            </tr>

                        {% for form in cell_id_overview_formset %}
                            <tr>

                                <td>{{ form.cell_id }}</td>
                                <td>{{ form.exclude }}</td>
                                <td>{{ form.number_of_active }}</td>
                                <td>{{ form.number_of_deprecated }}</td>
                                <td>{{ form.number_of_needs_importing }}</td>
                                <td>{{ form.first_active_file }}</td>

                            </tr>


                        {% endfor %}

                    </table>




                    <input type="submit" name = 'trigger_reimport' value = "Trigger Re-Importing">

            {% endif %}

            {% if visual_data %}
                    <table border="1">
                        {% for zd in visual_data %}
                            <tr valign="top">
                                {% for cell_id, image64 in zd %}
                                    <td valign="top">

                                        <a href="{% url 'cycling:view_cell_id'  cell_id  '' %}">
                                            <img src="data:image/png;base64,{{image64}}" alt="If you see this, there was an error. Send email to Samuel.Buteau@dal.ca" width=200 height=auto />
                                        </a>

                                             <font size="+2">{{cell_id}}</font>


                                    </td>
                                {% endfor %}
                            </tr>

                        {% endfor %}
                    </table>
            {% endif %}

        </tr>
        <tr>
            <table>
                {% if search_cell_by_valid_metadata_form %}
            <td valign="top">

                <table>
                    <tr>
                        <th> </th>  <th>Value to search</th>
                    <tr>
                        <th>Keyword in Filename</th>  <td>{{search_cell_by_valid_metadata_form.filename1}}</td>
                    </tr>
                    <tr>
                        <th>Keyword in Filename</th>  <td>{{search_cell_by_valid_metadata_form.filename2}}</td>
                    </tr>
                    <tr>
                        <th>Keyword in Filename</th>  <td>{{search_cell_by_valid_metadata_form.filename3}}</td>
                    </tr>


                    <tr>
                        <th>Keyword in Root</th> <td>{{ search_cell_by_valid_metadata_form.root1 }}</td>
                    </tr>
                    <tr>
                        <th>Keyword in Root</th> <td>{{ search_cell_by_valid_metadata_form.root2 }}</td>
                    </tr>
                    <tr>
                        <th>Keyword in Root</th> <td>{{ search_cell_by_valid_metadata_form.root3 }}</td>
                    </tr>

                    <tr>
                        <th> </th> <th>Exact Match</th> <th>Minimum</th> <th>Maximum</th>
                    <tr>

                    <tr>
                        <th>Char ID </th> <td>{{ search_cell_by_valid_metadata_form.charID_exact }}</td>  <td></td><td></td>
                    </tr>
                    <tr>
                        <th>Cell ID</th> <td>{{ search_cell_by_valid_metadata_form.cell_id_exact }}</td><td>{{ search_cell_by_valid_metadata_form.cell_id_minimum }}</td><td>{{ search_cell_by_valid_metadata_form.cell_id_maximum }}</td>
                    </tr>

                    <tr>
                        <th>Upper Cutoff Voltage</th> <td>{{ search_cell_by_valid_metadata_form.voltage_exact }}</td><td>{{ search_cell_by_valid_metadata_form.voltage_minimum }}</td><td>{{ search_cell_by_valid_metadata_form.voltage_maximum }}</td>
                    </tr>
                    <tr>
                        <th>Temperature</th> <td>{{ search_cell_by_valid_metadata_form.temperature_exact }}</td><td>{{ search_cell_by_valid_metadata_form.temperature_minimum }}</td><td>{{ search_cell_by_valid_metadata_form.temperature_maximum }}</td>
                    </tr>
                    <tr>
                        <th>Date</th> <td>{{ search_cell_by_valid_metadata_form.date_exact }}</td><td>{{ search_cell_by_valid_metadata_form.date_minimum }}</td><td>{{ search_cell_by_valid_metadata_form.date_maximum }}</td>
                    </tr>
                    <tr>
                        <th>Dataset</th> <td>{{search_cell_by_valid_metadata_form.dataset}}</td>
                    </tr>
                </table>
                <br>
                Limit other searches: {{search_cell_by_valid_metadata_form.only_valid_cells}}


            </td>

            {% endif %}


            {% if electrolyte_form %}
            <td valign="top">
            <h2>Electrolyte</h2>
                {%if electrolyte_page_form %}
                    Display Page: {{electrolyte_page_form.page_number}}
                {%endif%}
                <input type="submit" name = 'preview_electrolyte' value="Preview Electrolyte">
                {%if preview_electrolytes %}
                    {% if not preview_electrolytes|length == 0%}
                     Showing page {{electrolyte_page_number}}/{{electrolyte_max_page_number}}.
                        <table>
                            <tr>
                                <th>Preview Electrolytes</th>
                            </tr>
                            {% for electrolyte in preview_electrolytes %}
                                <tr>
                                    <td>{{electrolyte}}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    {% endif %}
                {% endif %}

                <table>{{ electrolyte_form.as_table }}</table>
                {% if electrolyte_composition_formset %}
                    {% csrf_token %}
                    {{ electrolyte_composition_formset.management_form }}
                    <table>
                        <tr>
                            <th>Molecule</th><th>Must have?</th><th>Amount</th><th>Tolerance</th>
                        </tr>
                        {% for form in electrolyte_composition_formset%}
                            <tr>
                                <td>{{ form.molecule}}</td><td>{{form.must_type}}</td><td>{{ form.ratio}}</td><td>{{ form.tolerance}}</td>
                            </tr>
                        {% endfor %}
                    </table>
                {% endif %}

            </td>
        {% endif %}


        {% if search_dry_cell %}
            <td valign="top">
            <h2>Dry Cell</h2>
                {%if dry_cell_page_form %}
                    Display Page: {{dry_cell_page_form.page_number}}
                {%endif%}

                 <input type="submit" name = 'preview_dry_cell' value="Preview Dry Cell">
                 <input type="submit" name = 'preview_dry_cell_lot'value="Preview Box IDs">

                {%if preview_dry_cells %}
                    {% if not preview_dry_cells|length == 0%}
                Showing page {{dry_cell_page_number}}/{{dry_cell_max_page_number}}.
                        <table>
                            <tr>
                                <th>Preview Dry Cells</th>
                            </tr>
                            {% for dry_cell in preview_dry_cells %}
                                <tr>
                                    <td>{{dry_cell}}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    {% endif %}
                {% endif %}
                {%if preview_dry_cell_lots %}
                    {% if not preview_dry_cell_lots|length == 0%}
                 Showing page {{dry_cell_page_number}}/{{dry_cell_max_page_number}}.
                        <table>
                            <tr>
                                <th>Preview Box IDs</th>
                            </tr>
                            {% for dry_cell_lot in preview_dry_cell_lots %}
                                <tr>
                                    <td>{{dry_cell_lot}}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    {% endif %}
                {% endif %}
                <table>{{ search_dry_cell.as_table }}</table>
                {% if dry_cell_scalars %}
                    {% csrf_token %}
                    {{ dry_cell_scalars.management_form }}
                    <table>
                        <tr>
                            <th>Field Name</th><th>Amount</th><th>Tolerance</th><th>Exclude Missing Values</th>
                        </tr>
                        {% for form in dry_cell_scalars%}
                            <tr>
                                <td>{{ form.name}}</td><td>{{form.scalar}}</td><td>{{ form.tolerance}}</td><td>{{ form.exclude_missing}}</td>
                            </tr>
                        {% endfor %}
                    </table>
                {% endif %}

            </td>
        {% endif %}


        </table>
        </tr>
    </table>

</form>



{% endblock %}